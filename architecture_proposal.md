# Предлагаемая архитектура Doca

## Текущие проблемы
- Весь код находится в одном файле `indexer.py`
- Отсутствует модульность и расширяемость
- Сложно добавить поддержку других типов файлов
- Смешаны различные уровни абстракции

## Предлагаемая структура

```
doca/
├── __init__.py                # Превращает директорию в пакет Python
├── config.py                  # Конфигурация, загрузка переменных окружения
├── cli.py                     # Интерфейс командной строки
├── core/                      # Основные компоненты
│   ├── __init__.py
│   ├── indexer.py             # Основной класс индексера
│   ├── embeddings.py          # Работа с эмбеддингами
│   └── storage.py             # Абстракция хранилища (Elasticsearch)
├── parsers/                   # Парсеры для разных типов файлов
│   ├── __init__.py
│   ├── base.py                # Базовый класс парсера
│   ├── markdown.py            # Парсер Markdown
│   ├── text.py                # Парсер обычного текста
│   └── html.py                # Парсер HTML (будущее расширение)
├── utils/                     # Вспомогательные функции
│   ├── __init__.py
│   ├── chunking.py            # Разбиение текста на чанки
│   └── memory.py              # Оптимизация памяти
└── main.py                    # Точка входа в приложение
```

## Основные компоненты и их ответственность

### config.py
- Загрузка переменных окружения из `.env`
- Определение констант и настроек по умолчанию
- Валидация конфигурации

### core/indexer.py
- Основной класс `DocumentIndexer`
- Координация процесса индексации
- Использование соответствующих парсеров и хранилища

### core/embeddings.py
- Класс `EmbeddingGenerator`
- Загрузка моделей
- Генерация эмбеддингов с оптимизацией памяти

### core/storage.py
- Абстракция для работы с хранилищем
- Класс `ElasticsearchStorage` для работы с Elasticsearch
- В будущем можно добавить другие хранилища

### parsers/base.py
- Абстрактный базовый класс `BaseParser`
- Определяет интерфейс для всех парсеров

### parsers/markdown.py
- Класс `MarkdownParser`, наследующийся от `BaseParser`
- Специфичная логика для обработки Markdown файлов

### utils/chunking.py
- Функции для разбиения текста на чанки
- Различные стратегии чанкинга

### cli.py
- Парсинг аргументов командной строки
- Создание и настройка объектов

### main.py
- Точка входа в приложение
- Минимальный код для запуска процесса индексации
